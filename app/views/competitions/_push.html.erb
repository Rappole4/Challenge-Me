<link href="https://fonts.googleapis.com/css?family=Poppins" rel="stylesheet">
<h1>Push-Ups</h1>
<table class="pushTable">
	<tr class="pushTr">
		<th class="pushTh">Names</th>
		<% @competition.participants.each do |participant| %>
		<th class="pushTh"><%= participant.username %></th>
		<% end %>
	</tr>
	<tr class="pushTr">
		<th class="pushTh">Goal</th>
		<% (1..@competition.competitor).each do |competition| %>
		<th class="pushTh" id="pushGoalcolor"><%= @competition.goal %></th>
		<% end %>
	</tr>
	<tr class="pushTr">
		<th class="pushTh">Day <%= @competition.created_at.day - (@competition.created_at.day-1) %></th>
		<% @competition.participants.each do |participant| %>
		<td name="A" data-participant="<%= participant.username %>" class="pushTd">200</td>
		<% end %>
	</tr>
	<tr class="pushTr">
		<th class="pushTh">Day <%= @competition.created_at.day - (@competition.created_at.day-2) %></th>
		<% @competition.participants.each do |participant| %>
		<td name="A" data-participant="<%= participant.username %>" class="pushTd">500</td>
		<% end %>
	</tr>
	<tr class="pushTr">
		<th class="pushTh">Totals</th>
		<% @competition.participants.each do |participant| %>
		<td id="TA" data-participant="<%= participant.username %>" class="pushTd totals"><strong></strong></td>
		<% end %>

	</tr>
	<tr class="pushTr">
		<th class="pushTh">Avg Per Day</th>
		<% @competition.participants.each do |participant| %>
		<td id="AA" data-participant="<%= participant.username %>" class="pushTd averages"><i></i></td>
		<% end %>

	</tr>
	<tr class="pushTr">
		<th class="pushTh">Hit Goal</th>
		<% @competition.participants.each do |participant| %>
		<td id="GA" data-participant="<%= participant.username %>" class="pushTd goal"><strong></strong></td>
		<% end %>

	</tr>
	<tr class="pushTr">
		<th class="pushTh">Most in Single Day</th>
		<% @competition.participants.each do |participant| %>
		<td id="HA" data-participant="<%= participant.username %>" class="pushTd most"><strong></strong></td>
		<% end %>

	</tr>
</table>

<script>
	// each days count
	var dayA;
	// highest count in one day
	var highA;
	// if person hit goal for the day
	var goalA;
	// for for loop
	var i;
	function totalA(){
		dayA = document.getElementsByName('A');
		//v--for finding totals (works)
		objA = [].reduce.call(dayA, function(obj, el){
			var key = el.getAttribute('data-participant');
			obj[key] = (obj[key]||0)+parseInt(el.innerHTML);
			return obj;
		},{});
		// ^-total found (works)
		// v--pulling total out and doing stuff with it (works)
		var elTotals = document.querySelectorAll('.totals');
		var elAverages = document.querySelectorAll('.averages');
		var elGoal = document.querySelectorAll('.goal');
		var elMost = document.querySelectorAll('.most');
		goalA = 0;
		for (i=0; i<elTotals.length; i++){
			var key = elTotals[i].getAttribute('data-participant');
			//v--each participants total displayed (works)
			elTotals[i].innerHTML = "<strong>"+objA[key]+"</strong>";
			//v--each participants average displayed (works)
			elAverages[i].innerHTML = "<i>"+objA[key]/<%=  Time.now.day - @competition.created_at.day + 2 %>+"</i>";
			//v--to do, fix to find biggest number for each participant not just biggest overall (HELP)
			elMost[i].innerHTML = Math.max.apply(null, [].map.call(dayA, c => parseInt(c.innerHTML )));
			//v--to do, fix to find if each day hit goal, not total****** (HELP)
			if ((objA[key])>=<%= @competition.goal %>){
				goalA += 1;
				elGoal[i].innerHTML = goalA;
			}
			else {
				elGoal[i].innerHTML = 0
			}
		}
		// v--to goal or not for loop (works) TO DO:change j<4 to something connected to Daily
		var elValue = parseInt(document.querySelectorAll('values'));
		for (j=0; j<(elTotals.length * <%=  Time.now.day - @competition.created_at.day + 2 %>); j++){
			if (parseInt(dayA[j].innerHTML)>=(<%= @competition.goal %>)) {
				// v--changes color of days where goal was met or not (works)
				dayA[j].style.color = "green";
			}
			else {
				dayA[j].style.color = "red";
			}
		}
	}
	// v--calls totalA() function (works)
	totalA();
</script>